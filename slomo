#!/bin/bash

slomo2 () {

  read -p 'search: ' search
  url=$(ytfzf -L ${search})

  read -p 'speed: ' speed
  read -p 'filename: ' filename
  
  # filepath="$HOME/.slomo/saved/${filename}"
  filepath="$SLOMO_DIR${filename}"
  temp="${filepath}.wav"
  dest="${filepath}.slomo.wav"

  youtube-dl \
    -o "${filepath}.%(ext)s" \
    -x --audio-format wav \
    --audio-quality 0 \
    --format bestaudio ${url} &&
  rubberband \
    --tempo ${speed} \
    --frequency ${speed} \
    ${temp} ${dest} &&
  mpv ${dest} && 
  # exit 2
  rm ${temp}

  trap - SIGINT
  [[ -f ${temp} ]] && rm ${temp}

}

slomo2
